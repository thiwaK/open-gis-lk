{{ define "main" }}


<div class="d-flex flex-grow-1 position-relative">

  <!-- Sidebar -->
  <nav id="navbar" class="sidebar d-flex flex-column flex-shrink-0 border-1 
  border-right shadow-sm position-sticky top-0">
    
    <button class="toggle-btn border-0" onclick="toggleNavbar()">
      <i class="bi bi-chevron-left"></i>
    </button>

    <div class="logo-text p-3 align-items-start overflow-hidden position-relative text-nowrap">
      <h4 class="fw-bold mb-0">OpenGISLK</h4>
      <p class="text-muted small fst-italic">The geospatial catalog</p>
    </div>

    <section class="nav flex-column overflow-hidde text-nowrap position-relative">
      <div class="topic-label h6 d-flex overflow-hidden text-center border-1 border-bottom border-top py-1 position-relative">
        <i class="bi bi-filter d-inline-block px-3"></i>
        <span class="d-inline-block">Topics</span>
      </div>

      <nav aria-label="Topics">
        <ul id="topics-list" class="nav flex-column overflow-hidden">
          <!-- JS will populate here -->
        </ul>
      </nav>
    </section>

    <!-- GitHub Footer -->
    <div id="navbar-footer" class="mt-auto px-3 py-2 border-top small position-relative text-nowrap position-sticky">
      <a href="https://github.com/thiwaK/open-gis-lk" target="_blank" class="text-decoration-none overflow-hidden">
        <i class="bi bi-github me-2"></i>
        <span class="">View on GitHub</span>
      </a>
    </div>

  </nav>

  <script>
    const navbar = document.getElementById('navbar');

    {
      {/*  function adjustMapSize() {

        const mapDiv = document.getElementById('map');

        const navbarWidth = navbar.offsetWidth;
        mapDiv.style.marginLeft = `${navbarWidth}px`;
        mapDiv.style.width = `calc(100% - ${navbarWidth}px)`;

        if (window.map) window.map.invalidateSize();
    }  */}
    }

    function toggleNavbar() {
      document.querySelector('.sidebar').classList.toggle('collapsed');
      // setTimeout(adjustMapSize, 310); // Wait for CSS transition to finish
    }

    {
      {/*  window.addEventListener('load', adjustMapSize);
    window.addEventListener('resize', adjustMapSize);  */}
    }
  </script>

  <!-- Catalog (scrollable) -->
  <div class="d-flex flex-grow-1 flex-column overflow-y-auto m-3 p-3">
    <h4 class="text-center fw-bold mb-3">Product Catalogue</h4>

    <div id="productTabContent" class="tab-content mt-3 flex-grow-0 align-items-stretch">
      <!-- dataset cards will render here -->
    </div>
  </div>

  <!-- Map -->
  <div class="map-view d-flex flex-column flex-shrink-0 position-sticky h-100 d-lg-flex d-none">
    <div id="dataset-map" class="w-100 h-100 position-fixed top-0 border-1 border-left shadow">
    </div>
  </div>
</div>


<!-- Mobile Map Overlay -->
<div id="mapOverlay" class="map-overlay d-none">
  <button class="close-btn btn btn-sm btn-light" onclick="hideMapOverlay()">âœ•</button>
  <div id="dataset-map-mobile" class="w-100 h-100">
    <!-- Mobile map -->
  </div>
</div>

<!-- Loading Overlay -->
<div id="loading-overlay"
  class="position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center bg-dark bg-opacity-50"
  style="z-index: 10000; display: none;">
  <div class="text-center text-white">
    <div class="spinner-border text-light mb-3" role="status" style="width: 3rem; height: 3rem;">
      <span class="visually-hidden">Loading...</span>
    </div>
    <div>Loading, please wait...</div>
  </div>
</div>

<!-- webgl warn -->
<div id="webgl-warning" class="d-flex justify-content-center py-5 d-none">
  <div class="card text-danger border-danger bg-danger-subtle text-danger-emphasis">
    <div class="card-header align-content-between justify-content-center fs-5">
      <i class="fa-solid fa-exclamation-triangle-fill"></i> Error
    </div>
    <div class="card-body">
      <h5 class="card-title">WebGL is not supported or is disabled in your browser</h5>
      <p class="card-text">Please enable it or switch to a compatible browser.</p>
      {{/* <a href="#" class="btn btn-danger bg-danger-emphasis">OK</a> */}}
    </div>
  </div>
</div>

<script>
  const canvas = document.createElement("canvas");
  const gl = canvas.getContext("webgl") || canvas.getContext("experimental-webgl");
  {
    {/*  if (!gl) {
      document.getElementById("webgl-warning").classList.remove("d-none");
    }  */}
  }
</script>

<!-- sidebar -->
{{ partial "sidebar.html" . }}

<!-- scripts -->
{{ partial "scripts.html" . }}

{{ end }}